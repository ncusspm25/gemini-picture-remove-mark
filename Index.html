<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Gemini 浮水印修復工具 v2.0</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; display: flex; flex-direction: column; align-items: center; padding: 50px; }
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; max-width: 900px; }
        .upload-zone { border: 3px dashed #007bff; padding: 40px; border-radius: 15px; cursor: pointer; background: #f0f7ff; transition: 0.3s; }
        .upload-zone:hover { background: #e1efff; }
        canvas { max-width: 100%; margin-top: 20px; border-radius: 10px; border: 1px solid #ddd; }
        .btn { display: inline-block; background: #28a745; color: white; padding: 12px 30px; border-radius: 50px; text-decoration: none; margin-top: 20px; font-weight: bold; }
        .info { color: #666; font-size: 0.9em; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="card">
    <h1>✨ Gemini 菱形移除器 v2.0</h1>
    <p class="info">針對高解析度圖片優化，自動偵測右下角區域</p>

    <div class="upload-zone" onclick="document.getElementById('input').click()">
        <h3>把有菱形的圖片丟進來</h3>
        <input type="file" id="input" accept="image/*" style="display:none" onchange="process(this.files[0])">
    </div>

    <div id="result" style="display:none;">
        <canvas id="cvs"></canvas>
        <br>
        <a id="dl" class="btn">下載乾淨的圖片</a>
    </div>
</div>

<script>
function process(file) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
            const cvs = document.getElementById('cvs');
            const ctx = cvs.getContext('2d');
            cvs.width = img.width;
            cvs.height = img.height;
            
            // 畫上原圖
            ctx.drawImage(img, 0, 0);

            // --- 進階修復邏輯 ---
            const w = img.width;
            const h = img.height;
            
            // 根據圖片比例計算浮水印範圍 (通常占寬度的 6-8%)
            const patchSize = Math.round(w * 0.08); 
            const x = w - patchSize;
            const y = h - patchSize;

            // 從浮水印「左側」抓取同樣大小的乾淨區域
            // 為了讓效果更自然，我們抓取 x - patchSize 的位置
            ctx.save();
            
            // 建立一個羽化效果的路徑，避免邊緣生硬
            ctx.beginPath();
            ctx.rect(x, y, patchSize, patchSize);
            ctx.clip();

            // 複製並貼上
            // 我們把 (x - patchSize, y) 這一塊貼到 (x, y)
            ctx.drawImage(cvs, x - patchSize, y, patchSize, patchSize, x, y, patchSize, patchSize);
            
            // 加上一點輕微模糊來混合接縫
            ctx.filter = 'blur(2px)';
            ctx.drawImage(cvs, x, y, patchSize, patchSize, x, y, patchSize, patchSize);
            ctx.restore();

            document.getElementById('result').style.display = 'block';
            document.getElementById('dl').href = cvs.toDataURL('image/png');
        }
        img.src = e.target.result;
    }
    reader.readAsDataURL(file);
}
</script>
</body>
</html>
