<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Gemini ç„¡ç—•ä¿®å¾© v5.0</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 500px; }
        .upload-area { border: 2px dashed #007bff; padding: 30px; border-radius: 15px; background: #f8fbff; cursor: pointer; margin: 20px 0; }
        canvas { max-width: 100%; border-radius: 10px; display: none; margin-top: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .btn { display: block; background: #28a745; color: white; padding: 15px; border-radius: 12px; text-decoration: none; font-weight: bold; margin-top: 15px; border: none; font-size: 16px; }
        #status { color: #666; font-size: 14px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>âœ¨ Gemini ç„¡ç—•ä¿®å¾© v5.0</h2>
    <p id="status">æº–å‚™å°±ç·’ (æ‰‹æ©Ÿå°ˆç”¨è¼•é‡ç‰ˆ)</p>

    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <strong>é»æ“Šé¸æ“‡å‰ä¼Šå¡å“‡åœ–ç‰‡</strong>
        <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="handleImage(this.files[0])">
    </div>

    <canvas id="mainCanvas"></canvas>
    
    <a id="downloadBtn" class="btn" style="display:none;">ä¸‹è¼‰å®Œç¾ç„¡ç—•åœ–ç‰‡</a>
</div>

<script>
function handleImage(file) {
    if (!file) return;
    const status = document.getElementById('status');
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const dlBtn = document.getElementById('downloadBtn');
    
    status.innerText = "ğŸš€ æ­£åœ¨é€²è¡Œæ™ºæ…§ç„¡ç—•ä¿®è£œ...";
    
    const img = new Image();
    img.onload = function() {
        canvas.width = img.width;
        canvas.height = img.height;
        canvas.style.display = "block";
        
        // 1. ç•«ä¸ŠåŸåœ–
        ctx.drawImage(img, 0, 0);

        // --- æ™ºæ…§ç„¡ç—•èåˆæ¼”ç®—æ³• ---
        const w = img.width;
        const h = img.height;
        
        // é‡å°ä¸åŒè§£æåº¦è‡ªå‹•èª¿æ•´ä¿®è£œç¯„åœ (ç´„ 8%)
        const size = Math.round(w * 0.08); 
        const x = w - size;
        const y = h - size;

        // å»ºç«‹ä¸€å€‹é›¢å±ç•«å¸ƒä¾†è™•ç†ã€Œç¾½åŒ–å€å¡Šã€
        const patchCanvas = document.createElement('canvas');
        patchCanvas.width = size;
        patchCanvas.height = size;
        const pCtx = patchCanvas.getContext('2d');

        // A. æŠ“å–æµ®æ°´å°ã€Œå·¦æ–¹ã€æˆ–ã€Œä¸Šæ–¹ã€çš„ä¹¾æ·¨èƒŒæ™¯
        // å„ªå…ˆå¾å·¦é‚ŠæŠ“å–ï¼Œå› ç‚ºè‰åœ°æ©«å‘é€£çºŒæ€§è¼ƒå¥½
        pCtx.drawImage(canvas, x - size, y, size, size, 0, 0, size, size);

        // B. å»ºç«‹åœ“å½¢å¾‘å‘æ¼¸å±¤é®ç½© (é€™æ˜¯ç„¡ç—•çš„é—œéµ)
        // è®“ä¸­å¿ƒå®Œå…¨è¦†è“‹ï¼Œé‚Šç·£å®Œå…¨é€æ˜
        const gradient = ctx.createRadialGradient(
            x + size/2, y + size/2, size * 0.1, // ä¸­å¿ƒ
            x + size/2, y + size/2, size * 0.6  // æ“´æ•£é‚Šç•Œ
        );
        gradient.addColorStop(0, 'rgba(0,0,0,1)');   // ä¸­å¿ƒå®Œå…¨ä¸é€æ˜
        gradient.addColorStop(0.8, 'rgba(0,0,0,0.8)'); 
        gradient.addColorStop(1, 'rgba(0,0,0,0)');   // é‚Šç·£å®Œå…¨é€æ˜

        // C. ä½¿ç”¨ã€Œç›®æ¨™é‡ç–Šã€æ¨¡å¼é€²è¡Œç¹ªè£½
        ctx.save();
        ctx.globalCompositeOperation = 'destination-out'; // å…ˆæŠŠè±å½¢ä½ç½®æŒ–æ‰ä¸€å€‹ç¾½åŒ–çš„æ´
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(x + size/2, y + size/2, size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();

        ctx.save();
        // åœ¨æ´çš„ä½ç½®è£œä¸Šå‰›æ‰æŠ“å–çš„èƒŒæ™¯ï¼Œå› ç‚ºæœ‰ç¾½åŒ–ï¼Œæœƒè·ŸåŸåœ–å®Œç¾èåˆ
        ctx.globalAlpha = 1.0;
        // ç¨å¾®åšä¸€é»æ¨¡ç³Šè™•ç†å¢åŠ è‡ªç„¶æ„Ÿ
        ctx.filter = 'blur(1px)'; 
        ctx.drawImage(patchCanvas, x, y, size, size);
        ctx.restore();

        // å®Œå·¥
        status.innerText = "âœ… ä¿®å¾©å®Œæˆï¼";
        dlBtn.href = canvas.toDataURL("image/png");
        dlBtn.style.display = "block";
        status.style.color = "#28a745";
    };
    
    const reader = new FileReader();
    reader.onload = (e) => img.src = e.target.result;
    reader.readAsDataURL(file);
}
</script>

</body>
</html>
