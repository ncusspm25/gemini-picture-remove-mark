<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini 專用去浮水印工具 (本地版)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
            margin: 0;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 800px;
            width: 100%;
        }
        h1 { color: #333; margin-bottom: 10px; }
        p { color: #666; margin-bottom: 30px; }
        
        .upload-box {
            border: 3px dashed #cbd5e0;
            border-radius: 12px;
            padding: 40px;
            cursor: pointer;
            transition: 0.3s;
            background: #fafafa;
        }
        .upload-box:hover {
            border-color: #4299e1;
            background: #ebf8ff;
        }
        .btn {
            background-color: #4299e1;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover { background-color: #3182ce; }
        
        #preview-area {
            display: none;
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        canvas {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .status { margin-top: 10px; font-weight: bold; color: #48bb78; }
    </style>
</head>
<body>

<div class="container">
    <h1>✨ Gemini 浮水印移除器</h1>
    <p>這是你的私人工具。圖片不會上傳，全部在你的電腦處理。</p>

    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
        <h3>點擊這裡選擇 Gemini 圖片</h3>
        <span style="font-size: 14px; color: #888;">或是直接把圖片拖進來</span>
        <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="handleFile(this.files[0])">
    </div>

    <div id="preview-area">
        <canvas id="myCanvas"></canvas>
        <div class="status">✅ 處理完成！菱形已移除</div>
        <a id="downloadBtn" class="btn" download="clean_image.png">下載處理後的圖片</a>
    </div>
</div>

<script>
    // 支援拖曳上傳
    const uploadBox = document.querySelector('.upload-box');
    uploadBox.addEventListener('dragover', (e) => { e.preventDefault(); });
    uploadBox.addEventListener('drop', (e) => {
        e.preventDefault();
        if(e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
    });

    function handleFile(file) {
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                processImage(img);
            }
            img.src = event.target.result;
        }
        reader.readAsDataURL(file);
    }

    function processImage(img) {
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');

        // 設定畫布大小與圖片一致
        canvas.width = img.width;
        canvas.height = img.height;

        // 1. 繪製原圖
        ctx.drawImage(img, 0, 0);

        // 2. 處理右下角浮水印邏輯
        // Gemini 的浮水印通常在右下角 60x60 範圍內
        const w = canvas.width;
        const h = canvas.height;
        const regionSize = 70; // 稍微加大範圍確保覆蓋
        
        // 定義要修補的區域 (右下角)
        const x_start = w - regionSize;
        const y_start = h - regionSize;

        // --- 簡易修復算法 (Texture Cloning) ---
        // 原理：我們從浮水印"左邊"的區域複製乾淨的像素過來蓋住它
        // 這是最簡單且不需安裝大型 AI 庫的方法，對草地/天空效果很好
        
        // 取得浮水印左邊的圖像數據 (作為修補來源)
        // 我們取 x_start 左邊 regionSize 寬度的區域
        const sourceX = x_start - regionSize; 
        
        if (sourceX > 0) {
            // 從左側複製一塊區域
            const sourceData = ctx.getImageData(sourceX, y_start, regionSize, regionSize);
            
            // 為了讓接縫自然，我們可以稍微做一點羽化處理 (簡單版：直接覆蓋)
            // 將這塊乾淨的區域貼到右下角
            ctx.putImageData(sourceData, x_start, y_start);
            
            // 進階：如果這是一張比較複雜的圖，單純複製可能會看出接縫
            // 這裡加一個簡單的模糊濾鏡在接縫處 (可選)
            // 但對於 Gemini 的小菱形，通常複製就夠了
        } else {
            // 如果圖片太窄，就用模糊處理
            ctx.filter = 'blur(10px)';
            ctx.drawImage(canvas, x_start, y_start, regionSize, regionSize, x_start, y_start, regionSize, regionSize);
            ctx.filter = 'none'; // 重置
        }

        // 3. 顯示結果並準備下載
        document.getElementById('preview-area').style.display = 'block';
        const downloadBtn = document.getElementById('downloadBtn');
        downloadBtn.href = canvas.toDataURL('image/png');
    }
</script>

</body>
</html>
