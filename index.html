<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Gemini ç´‹ç†ä¿®å¾©å·¥å…· v6.0</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: -apple-system, sans-serif; background: #eef2f3; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 95%; max-width: 500px; }
        .upload-area { border: 2px dashed #007bff; padding: 40px; border-radius: 15px; background: #f0f7ff; cursor: pointer; margin: 20px 0; }
        canvas { max-width: 100%; border-radius: 10px; display: none; margin-top: 15px; }
        .btn { display: block; background: #28a745; color: white; padding: 15px; border-radius: 12px; text-decoration: none; font-weight: bold; margin-top: 15px; border: none; font-size: 16px; }
        #status { color: #666; font-size: 14px; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ¨ æ™ºæ…§ç´‹ç†ä¿®å¾© v6.0</h2>
    <p id="status">æº–å‚™å°±ç·’ (æ™ºæ…§æ“´æ•£ç®—æ³•)</p>

    <div class="upload-area" id="dropZone">
        <strong>é»æ“Šæˆ–æ‹–å…¥åœ–ç‰‡</strong>
        <input type="file" id="fileInput" accept="image/*" style="display:none">
    </div>

    <canvas id="mainCanvas"></canvas>
    
    <a id="downloadBtn" class="btn" style="display:none;">ä¸‹è¼‰ç„¡ç—•åœ–ç‰‡</a>
</div>

<script>
const fileInput = document.getElementById('fileInput');
const dropZone = document.getElementById('dropZone');
const canvas = document.getElementById('mainCanvas');
const ctx = canvas.getContext('2d', { willReadFrequently: true });

dropZone.onclick = () => fileInput.click();

fileInput.onchange = (e) => handleImage(e.target.files[0]);

function handleImage(file) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        const img = new Image();
        img.onload = () => startRepair(img);
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

function startRepair(img) {
    document.getElementById('status').innerText = "ğŸ”® æ­£åœ¨ç·¨ç¹”ç´‹ç†...";
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0);

    const w = canvas.width;
    const h = canvas.height;
    const size = Math.round(w * 0.08); // åµæ¸¬ç¯„åœ
    const x = w - size;
    const y = h - size;

    // --- æ ¸å¿ƒæ¼”ç®—æ³•ï¼šå¤šå±¤æ¬¡æ™ºæ…§æ“´æ•£ ---
    // æˆ‘å€‘ä¸ç›´æ¥è²¼åœ–ï¼Œè€Œæ˜¯æŠŠé‚Šç·£çš„åƒç´ ã€Œæ¨ã€é€²å» 10 æ¬¡ï¼Œæ¯æ¬¡éƒ½å¸¶æœ‰é€æ˜åº¦
    for (let i = 0; i < 12; i++) {
        const offset = i * 2;
        const blurAmount = 1 + (i * 0.5);
        
        ctx.save();
        // å»ºç«‹ä¸€å€‹é€æ¼¸ç¸®å°çš„ä¿®å¾©ç’°
        ctx.beginPath();
        ctx.rect(x + offset, y + offset, size - offset*2, size - offset*2);
        ctx.clip();

        // å¾ç¨å¾®åç§»çš„ä½ç½®æŠ“å–åƒç´ ä¸¦é€²è¡Œæ¨¡ç³Šèåˆ
        ctx.filter = `blur(${blurAmount}px)`;
        // æŠ“å–è±å½¢ä¸Šæ–¹å’Œå·¦æ–¹çš„ã€Œä¹¾æ·¨ç´‹ç†ã€æ··å’Œ
        ctx.globalAlpha = 0.3; 
        ctx.drawImage(canvas, x - 5, y - 5, size, size, x + offset, y + offset, size, size);
        ctx.restore();
    }

    // --- åŠ å…¥å¾®é‡é›œè¨Š (Noise Injection) ---
    // è®“ä¿®å¾©å€åŸŸæ“æœ‰è·ŸåŸåœ–ä¸€æ¨£çš„æ•¸ä½é¡†ç²’æ„Ÿï¼Œä¸æœƒå¤ªæ­»æ»‘
    const idata = ctx.getImageData(x, y, size, size);
    const data = idata.data;
    for (let i = 0; i < data.length; i += 4) {
        const noise = (Math.random() - 0.5) * 5; // åŠ ä¸Šæ­£è²  5 çš„éš¨æ©Ÿäº®åº¦
        data[i] += noise;
        data[i+1] += noise;
        data[i+2] += noise;
    }
    ctx.putImageData(idata, x, y);

    // å®Œæˆä»‹é¢æ›´æ–°
    canvas.style.display = "block";
    document.getElementById('status').innerText = "âœ… ç„¡ç—•ä¿®å¾©å®Œæˆ";
    document.getElementById('downloadBtn').href = canvas.toDataURL("image/png");
    document.getElementById('downloadBtn').style.display = "block";
}
</script>
</body>
</html>

